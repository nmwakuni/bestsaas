name: Pull Request Checks

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  validate:
    name: Validate PR
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run all validations
        run: npm run validate

      - name: Check for console.log statements
        run: |
          if grep -r "console\.log" app/ --include="*.ts" --include="*.tsx" --exclude-dir=node_modules; then
            echo "‚ùå Found console.log statements. Please remove them or use console.warn/console.error"
            exit 1
          else
            echo "‚úÖ No console.log statements found"
          fi

      - name: Check bundle size
        run: |
          echo "Checking bundle size..."
          # This is a placeholder - actual implementation would compare against baseline
          npm run build || echo "Build check completed"

      - name: Comment PR with results
        uses: actions/github-script@v7
        if: always()
        with:
          script: |
            const output = `
            ## PR Validation Results üöÄ

            - ‚úÖ TypeScript compilation passed
            - ‚úÖ ESLint checks passed
            - ‚úÖ Prettier formatting passed
            - ‚úÖ All tests passed

            The code is ready for review!
            `;

            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: output
            })
